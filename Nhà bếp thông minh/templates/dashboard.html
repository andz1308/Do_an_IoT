<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Báº£ng Ä‘iá»u khiá»ƒn NhÃ  báº¿p ThÃ´ng minh</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <style>
    body { background-color: #f7f9fc; }
    .card { border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    h1 { font-size: 1.8rem; margin-bottom: 1rem; }
    .sensor-value { font-size: 1.4rem; font-weight: 600; color: #0d6efd; }
  </style>
</head>
<body class="p-4">

  <div class="container">
    <h1 class="text-center text-primary mb-4">ğŸ³ Há»‡ thá»‘ng NhÃ  báº¿p ThÃ´ng minh</h1>

    <div class="row g-4">
      <div class="col-md-4">
        <div class="card p-3">
          <h5>ğŸŒ¡ï¸ Nhiá»‡t Ä‘á»™ & Äá»™ áº©m</h5>
          <p>Nhiá»‡t Ä‘á»™: <span id="temp_c" class="sensor-value">--</span> Â°C</p>
          <p>Äá»™ áº©m: <span id="humidity" class="sensor-value">--</span> %</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card p-3">
          <h5>ğŸ”¥ Cáº£m biáº¿n khÃ³i & nhiá»‡t</h5>
          <p>KhÃ³i: <span id="smoke" class="sensor-value">--</span></p>
          <p>Nhiá»‡t Ä‘á»™: <span id="fire_temp" class="sensor-value">--</span> Â°C</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card p-3">
          <h5>ğŸ§¯ KhÃ­ Gas</h5>
          <p>MQ-2: <span id="mq2" class="sensor-value">--</span> ppm</p>
          <p>MQ-5: <span id="mq5" class="sensor-value">--</span> ppm</p>
        </div>
      </div>
    </div>

    <div class="row g-4 mt-2">
      <div class="col-md-4">
        <div class="card p-3">
          <h5>ğŸš° NÆ°á»›c</h5>
          <p>LÆ°u lÆ°á»£ng: <span id="water_flow" class="sensor-value">--</span> LPM</p>
          <p>Tráº¡ng thÃ¡i van: <span id="water_valve" class="badge bg-secondary">--</span></p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card p-3">
          <h5>ğŸ’¡ ÄÃ¨n báº¿p</h5>
          <p>Ãnh sÃ¡ng: <span id="lux" class="sensor-value">--</span> lux</p>
          <p>Chuyá»ƒn Ä‘á»™ng: <span id="motion" class="badge bg-secondary">--</span></p>
          <p>ÄÃ¨n: <span id="kitchen_light" class="badge bg-secondary">--</span></p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card p-3">
          <h5>âš ï¸ Cáº£nh bÃ¡o gáº§n nháº¥t</h5>
          <ul id="alerts" class="list-group small"></ul>
        </div>
      </div>
    </div>
  </div>

  <script>
    const socket = io();

    socket.on("update_state", (state) => {
      const s = state.sensors || {};
      const a = state.actuators || {};

      // Nhiá»‡t Ä‘á»™ & Ä‘á»™ áº©m
      if (s.temp_humidity) {
        document.getElementById("temp_c").innerText = s.temp_humidity.data.temp_c.toFixed(1);
        document.getElementById("humidity").innerText = s.temp_humidity.data.humidity.toFixed(1);
      }

      // KhÃ³i & nhiá»‡t
      if (s.smoke_temp) {
        document.getElementById("smoke").innerText = s.smoke_temp.data.smoke.toFixed(1);
        document.getElementById("fire_temp").innerText = s.smoke_temp.data.temp_c.toFixed(1);
      }

      // Gas
      if (s.mq2) document.getElementById("mq2").innerText = s.mq2.data.ppm.toFixed(1);
      if (s.mq5) document.getElementById("mq5").innerText = s.mq5.data.ppm.toFixed(1);

      // NÆ°á»›c
      if (s.water_flow) document.getElementById("water_flow").innerText = s.water_flow.data.lpm.toFixed(2);
      document.getElementById("water_valve").innerText = a.water_valve_open ? "Má»Ÿ" : "ÄÃ³ng";
      document.getElementById("water_valve").className = a.water_valve_open ? "badge bg-success" : "badge bg-secondary";

      // ÄÃ¨n & chuyá»ƒn Ä‘á»™ng
      if (s.motion_light) {
        document.getElementById("lux").innerText = s.motion_light.data.lux.toFixed(1);
        document.getElementById("motion").innerText = s.motion_light.data.motion ? "CÃ³" : "KhÃ´ng";
        document.getElementById("motion").className = s.motion_light.data.motion ? "badge bg-warning" : "badge bg-secondary";
      }

      document.getElementById("kitchen_light").innerText = a.kitchen_light ? "Báº­t" : "Táº¯t";
      document.getElementById("kitchen_light").className = a.kitchen_light ? "badge bg-success" : "badge bg-secondary";

      // Cáº£nh bÃ¡o
      const alertList = document.getElementById("alerts");
      alertList.innerHTML = "";
      (state.alerts || []).forEach(al => {
        const li = document.createElement("li");
        li.className = "list-group-item";
        li.textContent = new Date(al.time * 1000).toLocaleTimeString() + " - " + al.text;
        alertList.appendChild(li);
      });
    });
  </script>
</body>
</html>
